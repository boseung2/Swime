<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.swime.mapper.StudyListMapper">

    <select id="getList" resultType="com.swime.domain.StudyListVO">
        select sl.sn, sl.std_sn, u.picture, sl.user_id, u.name as user_name, gl.grp_role, sl.status, sl.reg_date
        from tstd_list sl, tuser u, tgrp_list gl, tstd s
        where sl.std_sn = s.sn and sl.user_id = u.id and sl.user_id = gl.user_id and sl.std_sn = #{stdSn} and sl.status = 'STUS01'
          and gl.grp_sn = s.grp_sn
    </select>

    <select id="getListWithPaging" resultType="com.swime.domain.StudyListVO">
    <![CDATA[
        select *
        from (
                 select rownum rn, sl.sn, sl.std_sn, u.picture, sl.user_id, u.name as user_name, gl.grp_role, sl.status, sl.reg_date
                 from tstd_list sl, tuser u, tgrp_list gl, tstd s
                 where sl.std_sn = s.sn and sl.user_id = u.id and sl.user_id = gl.user_id and sl.std_sn = #{stdSn} and sl.status = 'STUS01'
                   and gl.grp_sn = s.grp_sn and rownum <= #{pageNum} * #{amount}
             )
        where rn > (#{pageNum} - 1) * #{amount}
        ]]>
    </select>

    <select id="getWaitingList" resultType="com.swime.domain.StudyListVO">
        select sl.sn, sl.std_sn, u.picture, sl.user_id, u.name as user_name, gl.grp_role, sl.status, sl.reg_date
        from tstd_list sl, tuser u, tgrp_list gl, tstd s
        where sl.std_sn = s.sn and sl.user_id = u.id and sl.user_id = gl.user_id and sl.std_sn = #{stdSn} and sl.status = 'STUS03'
          and gl.grp_sn = s.grp_sn
    </select>

    <select id="getWaitingListWithPaging" resultType="com.swime.domain.StudyListVO">
    <![CDATA[
        select *
        from (
                 select rownum rn, sl.sn, sl.std_sn, u.picture, sl.user_id, u.name as user_name, gl.grp_role, sl.status, sl.reg_date
                 from tstd_list sl, tuser u, tgrp_list gl, tstd s
                 where sl.std_sn = s.sn and sl.user_id = u.id and sl.user_id = gl.user_id and sl.std_sn = #{stdSn} and sl.status = 'STUS03'
                   and gl.grp_sn = s.grp_sn and rownum <= #{pageNum} * #{amount}
             )
        where rn > (#{pageNum} - 1) * #{amount}
        ]]>
    </select>

    <select id="getAttendant" resultType="com.swime.domain.StudyListVO">
        select std_sn, user_id, status
        from tstd_list
        where std_sn = #{stdSn} and user_id = #{userId}
    </select>

    <insert id="insert">
        insert into tstd_list (sn, std_sn, user_id, status, reg_date)
        values(seq_std_list.nextval, #{stdSn}, #{userId}, #{status}, current_date)
    </insert>

    <update id="update">
        update tstd_list
        set status = #{status}
        where std_sn = #{stdSn} and user_id = #{userId}
    </update>

    <select id="count" resultType="int">
        select count(*)
        from tstd_list
        where std_sn = #{stdSn} and status='STUS01'
    </select>

</mapper>